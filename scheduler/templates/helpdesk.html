{% extends "base.html" %}

{% load google_links i18n %}
{% block content %}

    {% if notifications %}
        <div class="row">
            <h2>{% trans "Important news" %}</h2>
            {% for notification in notifications %}

                <div>
                    <h3>{{ notification.title }}</h3>
                    <h4>
                        {% blocktrans trimmed with facility_name=notification.facility.name date=notification.creation_date %}
                            {{ facility_name }} on {{ date }}
                        {% endblocktrans %}
                    </h4>
                    {{ notification.text|safe }}
                </div>
            {% endfor %}
        </div>
        <hr/>
    {% endif %}

    <div class="row">
        <h2>{% trans "Volunteers wanted" %}</h2>

        {% regroup shifts by facility as shifts_by_facility %}

        {% for facility_shifts in shifts_by_facility %}
            {% with facility_shifts.grouper as facility %}
                <div class="row">
                    <div class="col-md-12">
                        <h3>{{ facility }} </h3>
                    </div>
                    <div class="col-md-8">

                        {% if facility.address %}
                            <h5>{{ address_line }} <a
                                    href="{{ facility.address_line|google_maps_directions }}"
                                    target="_blank">&rarr; Google Maps</a>
                            </h5>
                        {% endif %}
                        <p>{{ facility.description|safe }}</p>
                    </div>

                    {% regroup facility_shifts.list by starting_time.date as shifts_by_time %}

                    <div class="col-md-4">
                        <h4>{% trans "open shifts" %}</h4>

                        <p>
                            {% for shift_time in shifts_by_time %}
                                {% with shift_time.grouper as shift_date %}
                                    <a href="{% url 'planner_by_facility' pk=facility.pk year=shift_date.year month=shift_date.month day=shift_date.day %}">
                                        {{ shift_date|date }}
                                    </a>
                                    <br/>
                                {% endwith %}
                            {% endfor %}
                        </p>
                    </div>
                </div>
                <hr>
            {% endwith %}
        {% endfor %}
    </div>
{% endblock %}
